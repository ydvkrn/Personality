<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Reel Of The Day</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        body {
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            background-color: #000;
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        }
        .video-container {
            position: relative;
            width: 100%;
            height: 100vh;
            scroll-snap-align: start;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }
        .start-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 15px 30px;
            font-size: 20px;
            background-color: #fff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            z-index: 10;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="reels-container"></div>

    <script>
        fetch('https://raw.githubusercontent.com/ydvkrn/Personality/refs/heads/main/data.json')
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.json();
            })
            .then(data => {
                const reels = data.content.mediaItems.find(item => item.name === "Reel Of The Day").reels;
                const container = document.getElementById('reels-container');

                reels.forEach((reel, index) => {
                    const div = document.createElement('div');
                    div.className = 'video-container';
                    div.id = `reel${index}`;

                    const button = document.createElement('button');
                    button.className = 'start-button';
                    button.textContent = 'Start';
                    button.onclick = () => playVideo(index);

                    const video = document.createElement('video');
                    video.id = `video${index}`;
                    video.src = reel.media;
                    video.muted = true;
                    video.preload = 'auto';

                    div.appendChild(button);
                    div.appendChild(video);
                    container.appendChild(div);
                });

                let activeIndex = -1; // No video active initially
                let lastScrollTop = 0;

                // Scroll event for instant switch
                window.addEventListener('scroll', () => {
                    const scrollTop = window.scrollY;
                    const windowHeight = window.innerHeight;
                    const newIndex = Math.round(scrollTop / windowHeight);

                    if (newIndex !== activeIndex && newIndex >= 0 && newIndex < reels.length) {
                        playVideo(newIndex);
                        activeIndex = newIndex;
                    }
                    lastScrollTop = scrollTop;
                }, { passive: true });

                // Initial video not playing until scrolled or clicked
                activeIndex = 0; // Set first video as active but not playing yet
                showVideo(0); // Show first video without playing
            })
            .catch(error => {
                console.error('Error fetching JSON:', error);
                document.body.innerHTML = '<p style="color: white; text-align: center;">Error loading reels.</p>';
            });

        function showVideo(index) {
            const allContainers = document.querySelectorAll('.video-container');
            allContainers.forEach((container, i) => {
                if (i === index) {
                    container.classList.remove('hidden');
                } else {
                    container.classList.add('hidden');
                }
            });
        }

        function playVideo(index) {
            const allContainers = document.querySelectorAll('.video-container');
            allContainers.forEach((container, i) => {
                const video = container.querySelector('video');
                const button = container.querySelector('.start-button');
                if (i === index) {
                    container.classList.remove('hidden');
                    button.style.display = 'none';
                    video.muted = false;
                    video.play().catch(err => console.error('Video play failed:', err));
                } else {
                    video.pause();
                    video.muted = true;
                    video.currentTime = 0;
                    container.classList.add('hidden');
                    button.style.display = 'block'; // Reset button for next time
                }
            });

            const container = document.getElementById(`reel${index}`);
            window.scrollTo({ top: container.offsetTop, behavior: 'smooth' });
        }
    </script>
</body>
</html>
