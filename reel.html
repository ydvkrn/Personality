<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Reel Of The Day</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            background-color: #000;
        }
        body {
            overflow-y: auto;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }
        .video-container {
            position: relative;
            width: 100%;
            height: 100vh;
            scroll-snap-align: start;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: auto;
        }
        .like-animation {
            position: absolute;
            width: 100px;
            height: 100px;
            pointer-events: none;
            z-index: 10;
            animation: fadeOut 1s ease forwards;
        }
        @keyframes fadeOut {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(1.5); }
        }
    </style>
</head>
<body>
    <div id="reels-container"></div>

    <script>
        fetch('https://raw.githubusercontent.com/ydvkrn/Personality/refs/heads/main/reels.json') // Line 57 - Tera link yahan daal diya
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.json();
            })
            .then(data => {
                const reels = data.reels;
                const container = document.getElementById('reels-container');
                let playedVideos = new Set();
                let videoOrder = [];
                let activeIndex = 0;

                const shuffleArray = (array) => array.sort(() => Math.random() - 0.5);
                videoOrder = shuffleArray([...reels]);

                videoOrder.forEach((reel, index) => {
                    const div = document.createElement('div');
                    div.className = 'video-container';
                    div.id = `reel${index}`;

                    const video = document.createElement('video');
                    video.id = `video${index}`;
                    video.src = reel.media;
                    video.muted = true;
                    video.loop = false;
                    video.playsInline = true;
                    video.preload = 'auto';

                    div.appendChild(video);
                    container.appendChild(div);

                    video.addEventListener('dblclick', (event) => {
                        const rect = video.getBoundingClientRect();
                        const x = event.clientX - rect.left;
                        const y = event.clientY - rect.top;

                        const likeImg = document.createElement('img');
                        likeImg.src = 'https://i.postimg.cc/QxNJKcCm/5bc5f0d4-5be6-4b5d-9fa7-52049e9890b2.gif';
                        likeImg.className = 'like-animation';
                        likeImg.style.left = `${x - 50}px`;
                        likeImg.style.top = `${y - 50}px`;
                        div.appendChild(likeImg);

                        setTimeout(() => likeImg.remove(), 1000);
                    });
                });

                function playCurrentVideo() {
                    document.querySelectorAll('.video-container video').forEach((vid, index) => {
                        if (index === activeIndex) {
                            vid.muted = false;
                            vid.play().catch(err => console.error('Play failed:', err));
                            playedVideos.add(videoOrder[index].id);
                        } else {
                            vid.pause();
                            vid.muted = true;
                            vid.currentTime = 0;
                        }
                    });
                }

                let isScrolling = false;
                let lastScrollTime = 0;

                window.addEventListener('wheel', (event) => {
                    const now = Date.now();
                    if (isScrolling || now - lastScrollTime < 600) return;

                    isScrolling = true;
                    lastScrollTime = now;

                    if (event.deltaY > 0 && activeIndex < videoOrder.length - 1) {
                        activeIndex++;
                        adjustVideoOrder();
                    } else if (event.deltaY < 0 && activeIndex > 0) {
                        activeIndex--;
                    }

                    document.getElementById(`reel${activeIndex}`).scrollIntoView({ behavior: 'smooth' });
                    playCurrentVideo();

                    setTimeout(() => isScrolling = false, 600);
                }, { passive: true });

                let touchStartY = 0;

                window.addEventListener('touchstart', (event) => {
                    touchStartY = event.touches[0].clientY;
                }, { passive: true });

                window.addEventListener('touchmove', (event) => {
                    const now = Date.now();
                    if (isScrolling || now - lastScrollTime < 600) return;

                    const touchEndY = event.touches[0].clientY;
                    const deltaY = touchStartY - touchEndY;

                    if (deltaY > 50 && activeIndex < videoOrder.length - 1) {
                        isScrolling = true;
                        lastScrollTime = now;
                        activeIndex++;
                        adjustVideoOrder();
                        document.getElementById(`reel${activeIndex}`).scrollIntoView({ behavior: 'smooth' });
                        playCurrentVideo();
                        setTimeout(() => isScrolling = false, 600);
                    } else if (deltaY < -50 && activeIndex > 0) {
                        isScrolling = true;
                        lastScrollTime = now;
                        activeIndex--;
                        document.getElementById(`reel${activeIndex}`).scrollIntoView({ behavior: 'smooth' });
                        playCurrentVideo();
                        setTimeout(() => isScrolling = false, 600);
                    }
                }, { passive: false });

                function adjustVideoOrder() {
                    if (activeIndex === videoOrder.length - 1 && playedVideos.size < reels.length) {
                        const unplayed = reels.filter(r => !playedVideos.has(r.id));
                        if (unplayed.length > 0) {
                            videoOrder.push(unplayed[Math.floor(Math.random() * unplayed.length)]);
                            updateVideoElements();
                        }
                    }
                }

                function updateVideoElements() {
                    const containers = document.querySelectorAll('.video-container');
                    videoOrder.forEach((reel, index) => {
                        if (index >= containers.length) {
                            const div = document.createElement('div');
                            div.className = 'video-container';
                            div.id = `reel${index}`;
                            const video = document.createElement('video');
                            video.id = `video${index}`;
                            video.src = reel.media;
                            video.muted = true;
                            video.loop = false;
                            video.playsInline = true;
                            video.preload = 'auto';
                            div.appendChild(video);
                            container.appendChild(div);

                            video.addEventListener('dblclick', (event) => {
                                const rect = video.getBoundingClientRect();
                                const x = event.clientX - rect.left;
                                const y = event.clientY - rect.top;

                                const likeImg = document.createElement('img');
                                likeImg.src = 'https://i.postimg.cc/QxNJKcCm/5bc5f0d4-5be6-4b5d-9fa7-52049e9890b2.gif';
                                likeImg.className = 'like-animation';
                                likeImg.style.left = `${x - 50}px`;
                                likeImg.style.top = `${y - 50}px`;
                                div.appendChild(likeImg);

                                setTimeout(() => likeImg.remove(), 1000);
                            });
                        }
                    });
                }

                const firstVideo = document.getElementById('video0');
                firstVideo.play().then(() => {
                    setTimeout(() => {
                        firstVideo.muted = false;
                    }, 100);
                }).catch(err => console.error('First video play failed:', err));
            })
            .catch(error => console.error('Error loading reels:', error));
    </script>
</body>
</html>
